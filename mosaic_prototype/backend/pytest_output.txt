---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_56670d12"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "3f80bc3d795f8498", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.397501Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "3f80bc3d795f8498", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:39.397777Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 112.82, "event": "request.completed", "route": "register", "path": "/register", "request_id": "3f80bc3d795f8498", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.399284Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_56670d12"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "3f80bc3d795f8498", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.397501Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "3f80bc3d795f8498", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:39.397777Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 112.82, "event": "request.completed", "route": "register", "path": "/register", "request_id": "3f80bc3d795f8498", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.399284Z"}
_______________________________________________ ERROR at setup of test_stats_progress_payload_structure _______________________________________________

client = <FlaskClient <Flask 'app'>>

    @pytest.fixture
    def auth_headers(client):
        username = f"user_{uuid.uuid4().hex[:8]}"
        password = "Passw0rd!"
        register_resp = client.post("/register", json={"username": username, "password": password})
>       assert register_resp.status_code == 201
E       assert 500 == 201
E        +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

tests/test_api.py:15: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_ee8925ea"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "e0e4a15ad588f37d", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.611989Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "e0e4a15ad588f37d", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:39.612303Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 112.31, "event": "request.completed", "route": "register", "path": "/register", "request_id": "e0e4a15ad588f37d", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.613822Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_ee8925ea"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "e0e4a15ad588f37d", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.611989Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "e0e4a15ad588f37d", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:39.612303Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 112.31, "event": "request.completed", "route": "register", "path": "/register", "request_id": "e0e4a15ad588f37d", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.613822Z"}
_________________________________________________ ERROR at setup of test_stats_progress_invalid_date __________________________________________________

client = <FlaskClient <Flask 'app'>>

    @pytest.fixture
    def auth_headers(client):
        username = f"user_{uuid.uuid4().hex[:8]}"
        password = "Passw0rd!"
        register_resp = client.post("/register", json={"username": username, "password": password})
>       assert register_resp.status_code == 201
E       assert 500 == 201
E        +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

tests/test_api.py:15: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_ceb72ad6"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "50163628f370a3b0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.829604Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "50163628f370a3b0", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:39.829906Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 116.93, "event": "request.completed", "route": "register", "path": "/register", "request_id": "50163628f370a3b0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.831422Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_ceb72ad6"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "50163628f370a3b0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.829604Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "50163628f370a3b0", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:39.829906Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 116.93, "event": "request.completed", "route": "register", "path": "/register", "request_id": "50163628f370a3b0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:39.831422Z"}
______________________________________________________ ERROR at setup of test_entries_pagination ______________________________________________________

client = <FlaskClient <Flask 'app'>>

    @pytest.fixture
    def auth_headers(client):
        username = f"user_{uuid.uuid4().hex[:8]}"
        password = "Passw0rd!"
        register_resp = client.post("/register", json={"username": username, "password": password})
>       assert register_resp.status_code == 201
E       assert 500 == 201
E        +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

tests/test_api.py:15: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_ed630022"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "5d9c95d93744497c", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.047480Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "5d9c95d93744497c", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:40.048217Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 117.31, "event": "request.completed", "route": "register", "path": "/register", "request_id": "5d9c95d93744497c", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.052523Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_ed630022"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "5d9c95d93744497c", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.047480Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "5d9c95d93744497c", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:40.048217Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 117.31, "event": "request.completed", "route": "register", "path": "/register", "request_id": "5d9c95d93744497c", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.052523Z"}
____________________________________________________ ERROR at setup of test_activities_pagination _____________________________________________________

client = <FlaskClient <Flask 'app'>>

    @pytest.fixture
    def auth_headers(client):
        username = f"user_{uuid.uuid4().hex[:8]}"
        password = "Passw0rd!"
        register_resp = client.post("/register", json={"username": username, "password": password})
>       assert register_resp.status_code == 201
E       assert 500 == 201
E        +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

tests/test_api.py:15: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_4e90d522"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "04d913ad2ec1fdbd", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.282240Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "04d913ad2ec1fdbd", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:40.282567Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 122.34, "event": "request.completed", "route": "register", "path": "/register", "request_id": "04d913ad2ec1fdbd", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.284069Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_4e90d522"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "04d913ad2ec1fdbd", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.282240Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "04d913ad2ec1fdbd", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:40.282567Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 122.34, "event": "request.completed", "route": "register", "path": "/register", "request_id": "04d913ad2ec1fdbd", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.284069Z"}
_______________________________________________________ ERROR at setup of test_today_pagination _______________________________________________________

client = <FlaskClient <Flask 'app'>>

    @pytest.fixture
    def auth_headers(client):
        username = f"user_{uuid.uuid4().hex[:8]}"
        password = "Passw0rd!"
        register_resp = client.post("/register", json={"username": username, "password": password})
>       assert register_resp.status_code == 201
E       assert 500 == 201
E        +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

tests/test_api.py:15: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_01b7abf6"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "09f091a14ad3188f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.496535Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "09f091a14ad3188f", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:40.496810Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 113.57, "event": "request.completed", "route": "register", "path": "/register", "request_id": "09f091a14ad3188f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.498314Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_01b7abf6"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "09f091a14ad3188f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.496535Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "09f091a14ad3188f", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:40.496810Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 113.57, "event": "request.completed", "route": "register", "path": "/register", "request_id": "09f091a14ad3188f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.498314Z"}
_______________________________________________ ERROR at setup of test_invalid_pagination_returns_error _______________________________________________

client = <FlaskClient <Flask 'app'>>

    @pytest.fixture
    def auth_headers(client):
        username = f"user_{uuid.uuid4().hex[:8]}"
        password = "Passw0rd!"
        register_resp = client.post("/register", json={"username": username, "password": password})
>       assert register_resp.status_code == 201
E       assert 500 == 201
E        +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

tests/test_api.py:15: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_a53e8c72"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "b002903f765c5490", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.720554Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "b002903f765c5490", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:40.720838Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 113.15, "event": "request.completed", "route": "register", "path": "/register", "request_id": "b002903f765c5490", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.722361Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_a53e8c72"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "b002903f765c5490", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.720554Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "b002903f765c5490", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:40.720838Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 113.15, "event": "request.completed", "route": "register", "path": "/register", "request_id": "b002903f765c5490", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.722361Z"}
___________________________________________________ ERROR at setup of test_today_cache_invalidation ___________________________________________________

client = <FlaskClient <Flask 'app'>>

    @pytest.fixture
    def auth_headers(client):
        username = f"user_{uuid.uuid4().hex[:8]}"
        password = "Passw0rd!"
        register_resp = client.post("/register", json={"username": username, "password": password})
>       assert register_resp.status_code == 201
E       assert 500 == 201
E        +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

tests/test_api.py:15: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_e2ae1293"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "0239fea22656f01d", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.947618Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "0239fea22656f01d", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:40.947891Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 113.21, "event": "request.completed", "route": "register", "path": "/register", "request_id": "0239fea22656f01d", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.949433Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_e2ae1293"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "0239fea22656f01d", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.947618Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "0239fea22656f01d", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:40.947891Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 113.21, "event": "request.completed", "route": "register", "path": "/register", "request_id": "0239fea22656f01d", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:40.949433Z"}
___________________________________________________ ERROR at setup of test_stats_cache_invalidation ___________________________________________________

client = <FlaskClient <Flask 'app'>>

    @pytest.fixture
    def auth_headers(client):
        username = f"user_{uuid.uuid4().hex[:8]}"
        password = "Passw0rd!"
        register_resp = client.post("/register", json={"username": username, "password": password})
>       assert register_resp.status_code == 201
E       assert 500 == 201
E        +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

tests/test_api.py:15: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_8c68bdb1"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "bf2ca6bd443a57b9", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.161838Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "bf2ca6bd443a57b9", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:41.162126Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 114.37, "event": "request.completed", "route": "register", "path": "/register", "request_id": "bf2ca6bd443a57b9", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.163671Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_8c68bdb1"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "bf2ca6bd443a57b9", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.161838Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "bf2ca6bd443a57b9", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:41.162126Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 114.37, "event": "request.completed", "route": "register", "path": "/register", "request_id": "bf2ca6bd443a57b9", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.163671Z"}
____________________________________________________ ERROR at setup of test_backup_status_defaults ____________________________________________________

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 201
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_backup_manager.py:22: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_35a2c241"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "daedf6ce153b16f4", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.479048Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "daedf6ce153b16f4", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:42.479355Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 140.69, "event": "request.completed", "route": "register", "path": "/register", "request_id": "daedf6ce153b16f4", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.480967Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_35a2c241"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "daedf6ce153b16f4", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.479048Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "daedf6ce153b16f4", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:42.479355Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 140.69, "event": "request.completed", "route": "register", "path": "/register", "request_id": "daedf6ce153b16f4", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.480967Z"}
___________________________________________________ ERROR at setup of test_backup_run_creates_files ___________________________________________________

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 201
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_backup_manager.py:22: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_1848d69a"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "b0e32c4f0c82e5ce", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.705920Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "b0e32c4f0c82e5ce", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:42.706742Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 130.19, "event": "request.completed", "route": "register", "path": "/register", "request_id": "b0e32c4f0c82e5ce", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.710812Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_1848d69a"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "b0e32c4f0c82e5ce", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.705920Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "b0e32c4f0c82e5ce", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:42.706742Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 130.19, "event": "request.completed", "route": "register", "path": "/register", "request_id": "b0e32c4f0c82e5ce", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.710812Z"}
__________________________________________________ ERROR at setup of test_backup_toggle_persistence ___________________________________________________

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 201
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_backup_manager.py:22: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_ade2ad97"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "ebf6ff506deecaf2", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.926508Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "ebf6ff506deecaf2", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:42.926893Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 118.89, "event": "request.completed", "route": "register", "path": "/register", "request_id": "ebf6ff506deecaf2", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.928442Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_ade2ad97"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "ebf6ff506deecaf2", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.926508Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "ebf6ff506deecaf2", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:42.926893Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 118.89, "event": "request.completed", "route": "register", "path": "/register", "request_id": "ebf6ff506deecaf2", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.928442Z"}
___________________________________________________ ERROR at setup of test_backup_download_endpoint ___________________________________________________

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 201
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_backup_manager.py:22: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_1c7d8c10"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "f5b104b584eadebc", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.172152Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "f5b104b584eadebc", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:43.172407Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 144.94, "event": "request.completed", "route": "register", "path": "/register", "request_id": "f5b104b584eadebc", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.173885Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_1c7d8c10"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "f5b104b584eadebc", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.172152Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "f5b104b584eadebc", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:43.172407Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 144.94, "event": "request.completed", "route": "register", "path": "/register", "request_id": "f5b104b584eadebc", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.173885Z"}
_________________________________________ ERROR at setup of test_export_json_includes_entries_and_activities __________________________________________

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 201
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_export.py:13: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_b6606823"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "3e7429684228e22f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.580378Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "3e7429684228e22f", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:43.581021Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 132.23, "event": "request.completed", "route": "register", "path": "/register", "request_id": "3e7429684228e22f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.584370Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_b6606823"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "3e7429684228e22f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.580378Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "3e7429684228e22f", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:43.581021Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 132.23, "event": "request.completed", "route": "register", "path": "/register", "request_id": "3e7429684228e22f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.584370Z"}
___________________________________________________ ERROR at setup of test_export_pagination_offset ___________________________________________________

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 201
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_export.py:13: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_bd726559"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "b6a137a60e7de262", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.872638Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "b6a137a60e7de262", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:43.872989Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 169.57, "event": "request.completed", "route": "register", "path": "/register", "request_id": "b6a137a60e7de262", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.874592Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_bd726559"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "b6a137a60e7de262", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.872638Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "b6a137a60e7de262", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:43.872989Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 169.57, "event": "request.completed", "route": "register", "path": "/register", "request_id": "b6a137a60e7de262", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:43.874592Z"}
______________________________________________________ ERROR at setup of test_export_csv_format _______________________________________________________

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 201
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_export.py:13: AssertionError
---------------------------------------------------------------- Captured stdout setup ----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_6fe49a7d"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "4a49aae2f733cb3f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:44.085464Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "4a49aae2f733cb3f", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:44.085874Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 118.65, "event": "request.completed", "route": "register", "path": "/register", "request_id": "4a49aae2f733cb3f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:44.087772Z"}
----------------------------------------------------------------- Captured log setup ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_6fe49a7d"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "4a49aae2f733cb3f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:44.085464Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "4a49aae2f733cb3f", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:44.085874Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 118.65, "event": "request.completed", "route": "register", "path": "/register", "request_id": "4a49aae2f733cb3f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:44.087772Z"}
====================================================================== FAILURES =======================================================================
________________________________________________________________ test_login_rate_limit ________________________________________________________________

client = <FlaskClient <Flask 'app'>>

    def test_login_rate_limit(client):
        from app import app
    
        username = f"user_{uuid.uuid4().hex[:8]}"
        password = "Passw0rd!"
        client.post("/register", json={"username": username, "password": password})
    
        original = app.config["RATE_LIMITS"]["login"]
        app.config["RATE_LIMITS"]["login"] = {"limit": 1, "window": 60}
    
        try:
            first = client.post("/login", json={"username": username, "password": password})
>           assert first.status_code == 200
E           assert 500 == 200
E            +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

tests/test_api.py:235: AssertionError
---------------------------------------------------------------- Captured stdout call -----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_4c0ac666"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "c9119f32f500b43f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:37.396205Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "c9119f32f500b43f", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:37.396543Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 111.81, "event": "request.completed", "route": "register", "path": "/register", "request_id": "c9119f32f500b43f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:37.398046Z"}
{"event_type": "auth.login", "user_id": 1, "message": "User logged in", "context": {"username": "user_4c0ac666", "is_admin": false}, "event": "activity_event", "route": "login", "path": "/login", "request_id": "b2edc47ebe20b98a", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:37.492553Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "login", "path": "/login", "request_id": "b2edc47ebe20b98a", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:37.492773Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 1028, in login\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 95.6, "event": "request.completed", "route": "login", "path": "/login", "request_id": "b2edc47ebe20b98a", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:37.494207Z"}
------------------------------------------------------------------ Captured log call ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_4c0ac666"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "c9119f32f500b43f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:37.396205Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "c9119f32f500b43f", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:37.396543Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 111.81, "event": "request.completed", "route": "register", "path": "/register", "request_id": "c9119f32f500b43f", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:37.398046Z"}
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.login", "user_id": 1, "message": "User logged in", "context": {"username": "user_4c0ac666", "is_admin": false}, "event": "activity_event", "route": "login", "path": "/login", "request_id": "b2edc47ebe20b98a", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:37.492553Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "login", "path": "/login", "request_id": "b2edc47ebe20b98a", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:37.492773Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 1028, in login\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 95.6, "event": "request.completed", "route": "login", "path": "/login", "request_id": "b2edc47ebe20b98a", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:37.494207Z"}
____________________________________________________________ test_register_and_login_flow _____________________________________________________________

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 201
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_auth.py:15: AssertionError
---------------------------------------------------------------- Captured stdout call -----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_18a62b"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "47d0081775eadc5a", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.384342Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "47d0081775eadc5a", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:41.384632Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 114.3, "event": "request.completed", "route": "register", "path": "/register", "request_id": "47d0081775eadc5a", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.386136Z"}
------------------------------------------------------------------ Captured log call ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_18a62b"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "47d0081775eadc5a", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.384342Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "47d0081775eadc5a", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:41.384632Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 114.3, "event": "request.completed", "route": "register", "path": "/register", "request_id": "47d0081775eadc5a", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.386136Z"}
___________________________________________________________ test_login_invalid_credentials ____________________________________________________________

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 401
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_auth.py:38: AssertionError
---------------------------------------------------------------- Captured stdout call -----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_999df4"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "783d6c4d9412b594", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.646088Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "783d6c4d9412b594", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:41.646404Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 141.87, "event": "request.completed", "route": "register", "path": "/register", "request_id": "783d6c4d9412b594", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.647896Z"}
{"event_type": "auth.login_failed", "user_id": 1, "message": "Invalid username or password", "context": {"username": "user_999df4"}, "event": "activity_event", "route": "login", "path": "/login", "request_id": "9073d157b7ebbd02", "method": "POST", "level": "warning", "timestamp": "2025-11-07T15:54:41.741222Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "login", "path": "/login", "request_id": "9073d157b7ebbd02", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:41.741456Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 1008, in login\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 94.45, "event": "request.completed", "route": "login", "path": "/login", "request_id": "9073d157b7ebbd02", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.742893Z"}
------------------------------------------------------------------ Captured log call ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_999df4"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "783d6c4d9412b594", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.646088Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "783d6c4d9412b594", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:41.646404Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 141.87, "event": "request.completed", "route": "register", "path": "/register", "request_id": "783d6c4d9412b594", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.647896Z"}
WARNING  mosaic.audit:audit.py:115 {"event_type": "auth.login_failed", "user_id": 1, "message": "Invalid username or password", "context": {"username": "user_999df4"}, "event": "activity_event", "route": "login", "path": "/login", "request_id": "9073d157b7ebbd02", "method": "POST", "level": "warning", "timestamp": "2025-11-07T15:54:41.741222Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "login", "path": "/login", "request_id": "9073d157b7ebbd02", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:41.741456Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 1008, in login\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 94.45, "event": "request.completed", "route": "login", "path": "/login", "request_id": "9073d157b7ebbd02", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:41.742893Z"}
_____________________________________________________________ test_expired_token_rejected _____________________________________________________________

client = <FlaskClient <Flask 'app'>>, monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7d6ed6e1e7e0>

>   ???
E   KeyError: 'access_token'

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_auth.py:60: KeyError
---------------------------------------------------------------- Captured stdout call -----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_d80db3"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "b0f2abe267fdc0a0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.093358Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "b0f2abe267fdc0a0", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:42.093646Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 119.02, "event": "request.completed", "route": "register", "path": "/register", "request_id": "b0f2abe267fdc0a0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.095156Z"}
{"event_type": "auth.login", "user_id": 1, "message": "User logged in", "context": {"username": "user_d80db3", "is_admin": false}, "event": "activity_event", "route": "login", "path": "/login", "request_id": "791eb45798adfae0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.191530Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "login", "path": "/login", "request_id": "791eb45798adfae0", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:42.191785Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 1028, in login\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 97.56, "event": "request.completed", "route": "login", "path": "/login", "request_id": "791eb45798adfae0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.193273Z"}
------------------------------------------------------------------ Captured log call ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_d80db3"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "b0f2abe267fdc0a0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.093358Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "b0f2abe267fdc0a0", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:42.093646Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 119.02, "event": "request.completed", "route": "register", "path": "/register", "request_id": "b0f2abe267fdc0a0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.095156Z"}
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.login", "user_id": 1, "message": "User logged in", "context": {"username": "user_d80db3", "is_admin": false}, "event": "activity_event", "route": "login", "path": "/login", "request_id": "791eb45798adfae0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.191530Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "login", "path": "/login", "request_id": "791eb45798adfae0", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:42.191785Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 1028, in login\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 97.56, "event": "request.completed", "route": "login", "path": "/login", "request_id": "791eb45798adfae0", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:42.193273Z"}
___________________________________________________________ test_stream_proxy_authorized_ok ___________________________________________________________

client = <FlaskClient <Flask 'app'>>, monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7d6ed6d7f380>

>   ???

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_stream_proxy.py:27: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 201
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_stream_proxy.py:19: AssertionError
---------------------------------------------------------------- Captured stdout call -----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_826ea9"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "e19167a8bc89bc05", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:45.544672Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "e19167a8bc89bc05", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:45.545039Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 172.62, "event": "request.completed", "route": "register", "path": "/register", "request_id": "e19167a8bc89bc05", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:45.548097Z"}
------------------------------------------------------------------ Captured log call ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_826ea9"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "e19167a8bc89bc05", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:45.544672Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "e19167a8bc89bc05", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:45.545039Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 172.62, "event": "request.completed", "route": "register", "path": "/register", "request_id": "e19167a8bc89bc05", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:45.548097Z"}
____________________________________________________________ test_stream_proxy_rate_limit _____________________________________________________________

client = <FlaskClient <Flask 'app'>>, monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7d6ed6d6fb30>

>   ???

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_stream_proxy.py:60: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

client = <FlaskClient <Flask 'app'>>

>   ???
E   assert 500 == 201
E    +  where 500 = <WrapperTestResponse streamed [500 INTERNAL SERVER ERROR]>.status_code

/home/jan/Dokumenty/code/mosaic/mosaic_prototype/backend/tests/test_stream_proxy.py:19: AssertionError
---------------------------------------------------------------- Captured stdout call -----------------------------------------------------------------
{"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_7b3078"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "ee256a3baf028aa7", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:46.012960Z"}
{"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "ee256a3baf028aa7", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:46.013319Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
{"status_code": 500, "duration_ms": 168.61, "event": "request.completed", "route": "register", "path": "/register", "request_id": "ee256a3baf028aa7", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:46.014985Z"}
------------------------------------------------------------------ Captured log call ------------------------------------------------------------------
INFO     mosaic.audit:audit.py:115 {"event_type": "auth.register", "user_id": 1, "message": "User registered", "context": {"username": "user_7b3078"}, "event": "activity_event", "route": "register", "path": "/register", "request_id": "ee256a3baf028aa7", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:46.012960Z"}
ERROR    mosaic.backend:app.py:1315 {"status_code": 500, "error": "create_scoped_session", "event": "request.unhandled_exception", "route": "register", "path": "/register", "request_id": "ee256a3baf028aa7", "method": "POST", "level": "error", "timestamp": "2025-11-07T15:54:46.013319Z", "exception": "Traceback (most recent call last):\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 880, in full_dispatch_request\n    rv = self.dispatch_request()\n         ^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask/app.py\", line 865, in dispatch_request\n    return self.ensure_sync(self.view_functions[rule.endpoint])(**view_args)  # type: ignore[no-any-return]\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/app/app.py\", line 951, in register\n    log_event(\n  File \"/app/audit.py\", line 123, in log_event\n    _persist_log(\n  File \"/app/audit.py\", line 76, in _persist_log\n    session = db.create_scoped_session()\n              ^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/usr/local/lib/python3.12/site-packages/flask_sqlalchemy/extension.py\", line 1008, in __getattr__\n    raise AttributeError(name)\nAttributeError: create_scoped_session. Did you mean: '_make_scoped_session'?"}
INFO     mosaic.backend:app.py:468 {"status_code": 500, "duration_ms": 168.61, "event": "request.completed", "route": "register", "path": "/register", "request_id": "ee256a3baf028aa7", "method": "POST", "level": "info", "timestamp": "2025-11-07T15:54:46.014985Z"}
=============================================================== short test summary info ===============================================================
FAILED tests/test_api.py::test_login_rate_limit - assert 500 == 200
FAILED tests/test_auth.py::test_register_and_login_flow - assert 500 == 201
FAILED tests/test_auth.py::test_login_invalid_credentials - assert 500 == 401
FAILED tests/test_auth.py::test_expired_token_rejected - KeyError: 'access_token'
FAILED tests/test_stream_proxy.py::test_stream_proxy_authorized_ok - assert 500 == 201
FAILED tests/test_stream_proxy.py::test_stream_proxy_rate_limit - assert 500 == 201
ERROR tests/test_api.py::test_get_entries_empty - assert 500 == 201
ERROR tests/test_api.py::test_add_activity_and_toggle - assert 500 == 201
ERROR tests/test_api.py::test_add_activity_requires_category - assert 500 == 201
ERROR tests/test_api.py::test_add_activity_requires_frequency - assert 500 == 201
ERROR tests/test_api.py::test_add_entry_upsert - assert 500 == 201
ERROR tests/test_api.py::test_today_and_finalize_day - assert 500 == 201
ERROR tests/test_api.py::test_add_entry_validation - assert 500 == 201
ERROR tests/test_api.py::test_rate_limit_enforced - assert 500 == 201
ERROR tests/test_api.py::test_api_key_enforced - assert 500 == 201
ERROR tests/test_api.py::test_import_csv_endpoint - assert 500 == 201
ERROR tests/test_api.py::test_delete_entry_not_found_returns_standard_error - assert 500 == 201
ERROR tests/test_api.py::test_csrf_is_required_for_mutations - assert 500 == 201
ERROR tests/test_api.py::test_update_activity_propagates - assert 500 == 201
ERROR tests/test_api.py::test_today_respects_deactivation_date - assert 500 == 201
ERROR tests/test_api.py::test_entry_metadata_survives_activity_deletion - assert 500 == 201
ERROR tests/test_api.py::test_entries_filtering - assert 500 == 201
ERROR tests/test_api.py::test_stats_progress_payload_structure - assert 500 == 201
ERROR tests/test_api.py::test_stats_progress_invalid_date - assert 500 == 201
ERROR tests/test_api.py::test_entries_pagination - assert 500 == 201
ERROR tests/test_api.py::test_activities_pagination - assert 500 == 201
ERROR tests/test_api.py::test_today_pagination - assert 500 == 201
ERROR tests/test_api.py::test_invalid_pagination_returns_error - assert 500 == 201
ERROR tests/test_api.py::test_today_cache_invalidation - assert 500 == 201
ERROR tests/test_api.py::test_stats_cache_invalidation - assert 500 == 201
ERROR tests/test_backup_manager.py::test_backup_status_defaults - assert 500 == 201
ERROR tests/test_backup_manager.py::test_backup_run_creates_files - assert 500 == 201
ERROR tests/test_backup_manager.py::test_backup_toggle_persistence - assert 500 == 201
ERROR tests/test_backup_manager.py::test_backup_download_endpoint - assert 500 == 201
ERROR tests/test_export.py::test_export_json_includes_entries_and_activities - assert 500 == 201
ERROR tests/test_export.py::test_export_pagination_offset - assert 500 == 201
ERROR tests/test_export.py::test_export_csv_format - assert 500 == 201
====================================================== 6 failed, 24 passed, 31 errors in 11.12s ==========================